setwd("~/Downloads")
library(data.table)
library(dplyr)
library(ggplot2)
library(tidyr)
library (tibble)
library (readr)
library(cowplot)
library(here)
#to make here work open R Studio by opening this script. This script needs to be in folder that contains aother folder called 'data' containing the csv with data there
data <- read.csv(here("data", "fishenv.csv"))
head(data)
#delete the first column
data2 <- data %>% select (-1)
head(data2)
#completeness
data3<- data2 %>% complete(transect, nesting(Species)) #if I nest also site it messes up the data
data3
#now remove site column because now contains NAs
data3 <- data3 %>% select(-Site)
data3
#turn NAs into zeros
data3[is.na(data3)] <- 0
data3
View(data3)
View(data2)
#create new site column
# Adding column based on other column:
data3<-data3 %>%
mutate(Site = case_when(
startsWith(transect, "ALR") ~ "ALR",
startsWith(transect, "SIS") ~ "SIS",
startsWith(transect, "ROL") ~ "ROL",
startsWith(transect, "RNW") ~ "RNW",
startsWith(transect, "PBL") ~ "PBL",
startsWith(transect, "PST") ~ "PST",
startsWith(transect, "SCR") ~ "SCR",
startsWith(transect, "PPR") ~ "PPR"
))
data3
#subset C. capistratus
capis <- data3 %>% filter(Species ==  "Chaetodon capistratus")
head(capis)
capis <- as.data.table(capis)
capis
View(capis)
#subset H. puella
puella <- data3 %>% filter(Species ==  "Hypoplectrus puella")
head(puella)
puella <- as.data.table(puella)
##FISH DENSITY
#we want to calculate density for each transect first and then take mean and sd across transects per site
#this just reorganises the columns and calls 'total'='V1'
capis2  <- unique(capis [,sum(Total), by = list(Site, transect, Species)])
View(capis2)
capis2
puella2  <- unique(puella [,sum(Total), by = list(Site, transect, Species)])
puella2
#calculate density by site --note 2025: this seems to calculate density per transect
#we used 20m x 5m belt = 100m2
capis3 <- unique(capis2 [,(V1/100), by = list(Site, Species)])
View(capis3)
#capis3 <- unique(capis2 [,(V1/100), by = list(Site)])
capis3
capis3 <- as.data.table(capis3)
puella3 <- unique(puella2 [,(V1/100), by = list(Site, Species)])
#puella3 <- unique(puella2 [,(V1/100), by = list(Site)])
puella3
puella3  <- as.data.table(puella3)
# Adding Zone column:
capis3 <-capis3  %>%
mutate(Zone = case_when(
endsWith(Site, "ALR") ~ "Inner bay",
endsWith(Site, "SIS") ~ "Inner bay",
endsWith(Site, "ROL") ~ "Inner bay",
endsWith(Site, "RNW") ~ "Inner bay disturbed",
endsWith(Site, "PBL") ~ "Inner bay disturbed",
endsWith(Site, "PST") ~ "Inner bay disturbed",
endsWith(Site, "SCR") ~ "Outer bay",
endsWith(Site, "PPR") ~ "Outer bay"
))
# Adding Zone column:
puella3 <-puella3  %>%       #or use puella2 for only mean abundance (not density)
mutate(Zone = case_when(
endsWith(Site, "ALR") ~ "Inner bay",
endsWith(Site, "SIS") ~ "Inner bay",
endsWith(Site, "ROL") ~ "Inner bay",
endsWith(Site, "RNW") ~ "Inner bay disturbed",
endsWith(Site, "PBL") ~ "Inner bay disturbed",
endsWith(Site, "PST") ~ "Inner bay disturbed",
endsWith(Site, "SCR") ~ "Outer bay",
endsWith(Site, "PPR") ~ "Outer bay"
))
#function for summarizing the data
data_summary <- function(data, varname, groupnames){
require(plyr)
summary_func <- function(x, col){
c(mean = mean(x[[col]], na.rm=TRUE),
sd = sd(x[[col]], na.rm=TRUE))
}
data_sum<-ddply(data, groupnames, .fun=summary_func,
varname)
data_sum <- rename(data_sum, c("mean" = varname))
return(data_sum)
}
capis4 <- data_summary(capis3, varname="V1",
groupnames=c("Site", "Zone"))
View(capis4)
puella4 <- data_summary(puella3, varname="V1",
groupnames=c("Site","Zone"))
puella4
capis4$Site<-factor(capis4$Site,
levels=c("SCR", "PPR", "ALR", "SIS", "ROL", "PST", "RNW", "PBL"))
puella4$Site<-factor(puella4$Site,
levels=c("SCR", "PPR", "ALR", "SIS", "ROL", "PST", "RNW", "PBL"))
level_order <- c('Outer bay','Inner bay','Inner bay disturbed')
#set theme for plotting
font_theme = theme(
axis.title.x = element_text(size = 14),
axis.text.x = element_text(size = 8),
axis.title.y = element_text(size = 14),
axis.text.y = element_text(size =8))
#set colors
disp.pal1<-c("lightskyblue", "mediumaquamarine", "lightsalmon")
disp.pal2<-c("royalblue3", "aquamarine4", "chocolate")
disp.pal<-c("royalblue1", "lightskyblue", "mediumaquamarine","darkseagreen2", "darkseagreen1","chocolate", "chocolate1", "lightsalmon")
library(ggtext)
fig1 <- ggplot(data=capis4, aes(x=factor(Zone, level=level_order), y=V1))+
#geom_dotplot(binaxis='y', stackdir ='center', binwidth = 1.5, dotsize=0.6, aes(color=Reef, fill=Reef), alpha=1)+    #  geom_dotplot(binaxis='y', stackdir ='center', binwidth = 1.5, dotsize=1, aes(color=Reef), fill="white", alpha=1)+
geom_dotplot(binaxis='y', stackdir ='center', dotsize=1.5,  stroke = 3.5, aes(color=Site), fill="white", alpha=1)+ #binwidth = 0.1, dotsize=0.007,
# geom_dotplot(binaxis='y', stackdir ='centerwhole',  method="dotdensity", stackgroups = T,
#  binpositions="all", dotsize=1.5, stroke = 3.5, aes(color=Site), fill="white", alpha=1)+
# Use geom_errorbar()
stat_summary(fun.data=mean_se, fun.args = list(mult=1),  # standard deviation: fun.data=mean_sdl  standard error: "mean_se"
geom="errorbar", width=0.2, color="black") +
stat_summary(fun=mean, geom="point", color="black", fill = "white", shape=23, size=2)+
scale_colour_manual(values=disp.pal, name = "Reef")+
scale_fill_manual(values=disp.pal, name = "Reef")+
# labs(title = 'Fish density\nChaetodon capistratus')+
#labs(title = expression(italic("Chaetodon capistratus")), tag = "A")+
labs(title = "**_Chaetodon capistratus_**", tag = "C") +
theme_cowplot()+
theme(
plot.title = element_markdown(),
plot.tag = element_text(face = "bold")
)+
font_theme+
#ylim(0, 0.15)+
scale_x_discrete(name="Zone") + scale_y_continuous(name="Mean density",limits = c(0, 0.1))
fig1
library(data.table)
library(dplyr)
library(ggplot2)
library(tidyr)
library (tibble)
library (readr)
library(cowplot)
library(here)
#to make here work open R Studio by opening this script. This script needs to be in folder that contains aother folder called 'data' containing the csv with data there
data <- read.csv(here("data", "fishenv.csv"))
setwd("~/Downloads")
#to make here work open R Studio by opening this script. This script needs to be in folder that contains aother folder called 'data' containing the csv with data there
data <- read.csv(here("data", "fishenv.csv"))
setwd("~/Downloads/data")
#to make here work open R Studio by opening this script. This script needs to be in folder that contains aother folder called 'data' containing the csv with data there
data <- read.csv(here("data", "fishenv.csv"))
setwd("~/Downloads/data")
#to make here work open R Studio by opening this script. This script needs to be in folder that contains aother folder called 'data' containing the csv with data there
data <- read.csv(here("data", "fishenv.csv"))
setwd("~/Downloads")
#to make here work open R Studio by opening this script. This script needs to be in folder that contains aother folder called 'data' containing the csv with data there
data <- read.csv(here("data", "fishenv.csv"))
library(data.table)
library(dplyr)
library(ggplot2)
library(tidyr)
library (tibble)
library (readr)
library(cowplot)
library(here)
#to make here work open R Studio by opening this script. This script needs to be in folder that contains aother folder called 'data' containing the csv with data there
data <- read.csv(here("data", "fishenv.csv"))
setwd("~/Downloads/data")
#to make here work open R Studio by opening this script. This script needs to be in folder that contains aother folder called 'data' containing the csv with data there
data <- read.csv(here("data", "fishenv.csv"))
#to make here work open R Studio by opening this script. This script needs to be in folder that contains aother folder called 'data' containing the csv with data there
data <- read.csv("~/Downloads", "fishenv.csv"))
library(readr)
library(dplyr)
library(stringdist) # fuzzy searches
summary <- readr::read_tsv("~/Dropbox (Personal)/STRI_Digest_NSF/ESC_COI_hostASV_summaryTable.csv")
View(summary)
summary <- readr::read_csv("~/Dropbox (Personal)/STRI_Digest_NSF/ESC_COI_hostASV_summaryTable.csv")
summary <- "~/Dropbox (Personal)/STRI_Digest_NSF/ESC_COI_hostASV_summaryTable.csv"
table <- read.csv(summary, header=TRUE, sep = ",", row.names = NULL)
View(table)
summary <- "~/Dropbox (Personal)/STRI_Digest_NSF/ESC_COI_hostASV_withTax.csv"
table <- read.csv(summary, header=TRUE, sep = ",", row.names = NULL)
View(table)
View(table)
str(table)
library(Biostrings)
# Create fasta headers: "Species_ASV"
headers <- paste(table$Species, table$ASV, sep = "_")
# Turn into DNAStringSet
fasta_seqs <- DNAStringSet(table$seq)
names(fasta_seqs) <- headers
# Write to fasta file
writeXStringSet(fasta_seqs, filepath = "output.fasta")
# Write to fasta file
writeXStringSet(fasta_seqs, filepath = "~/Dropbox (Personal)/STRI_Digest_NSF/output.fasta")
quarto clean
